<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Route Viewer - Debug</title>
</head>
<body>
  <h1>Route Viewer Debug</h1>
  <div id="log">Initializing...</div>

  <script src="https://alcdn.msauth.net/browser/2.38.0/js/msal-browser.min.js"></script>
<script>
  const msalConfig = {
    auth: {
      clientId: "bea6e2a8-6d4d-47fd-b009-51977da0cf17",
      redirectUri: "https://dsvidenko.github.io/routes.html"
    }
  };

  const msalInstance = new msal.PublicClientApplication(msalConfig);

  window.addEventListener("DOMContentLoaded", async () => {
    try {
      const result = await msalInstance.handleRedirectPromise();
      if (result) {
        msalInstance.setActiveAccount(result.account);
      } else {
        const accounts = msalInstance.getAllAccounts();
        if (accounts.length > 0) {
          msalInstance.setActiveAccount(accounts[0]);
        } else {
          document.body.innerHTML = '<h2>Not signed in. Please go back and connect.</h2>';
          return;
        }
      }

      const response = await msalInstance.acquireTokenSilent({
        scopes: ["Files.Read.All", "User.Read"]
      });

      // Successfully got token - proceed with app logic
      console.log("Token acquired:", response.accessToken);
      document.body.innerHTML = "<h2>Logged in successfully.</h2>";

    } catch (error) {
      console.error("Error acquiring token silently:", error);
      document.body.innerHTML = `<h2>Error: ${error.message}</h2><p>Please try logging in again.</p>`;
      // Don't redirect automatically here â€” let user retry manually
    }
  });
</script>

</body>
</html>
